# Changelog

## Version 0.0.4

- Alarm plugin for Clock, Weather Station, ...
- NTP plugin: Check once per minute if the time is valid and call configTime() again if not
- MQTT metrics: uptime, heap
- Added Alarm plugin to Clock and Weather Station
- KFC OTA copies firmware.elf and stores the hash in the device configuration
- Rewritten StreamWrapper (Serial, DebugSerial, SerialHandler etc...)
- Rewritten SerialHandler
- Improved plugin system, ~2kb more free RAM
- Added boot option to set passwords to default, enable AP mode and web server
- Support for zeroconf (`${zeroconf:<service>.<proto>:<address|value[:port value]>|<fallback[:port]>}` as hostname)
- Blacklist to prevent plugins being loaded at start-up
- Debug print functions for IRAM_ATTR that do not pull the entire SerialWrapper code into IRAM
- Templates for configuration getters/setters
- Added SSDP plugin
- Improved HTML form generator
- Added missing html enitities encoding to forms
- Open/close automation for the Blinds Plugin, audible warning while running or shortly before
- MQTT auto discovery rebroadcast interval
- Zeroconf resolve button for forms
- Javascript updates and fixes
- Enable recovery mode after version change (AP mode enabled, default SSID, broadcast SSID, enable web server, reset passwords IF empty)
- Disable AP mode after 15min. if default password is used (does not apply to AP mode in standby)
- Removed test mode from the blinds plugin and implemented it into kfwfc_tool
- AT mode command DUMPM for dumping memory or flash contents
- 64KB flash storage (R/W) dedicated for the firmware
- Clearing EspSaveCrash EEPROM during factory reset
- Device title is being used as name for MQTT auto discovery
- Ping monitor improvements
- Memory debugging and leak detection added
- Improved event scheduler (freed ~500 byte IRAM), memory usage and performance
- Removed filters from syslog, reduced memory usage and improved performance
- Read ADC over web sockets with kfcfw_tool and graphical analysis
- Major improvements for forms, they are using ~10x less memory and are ~20x faster. Most need less than 1KB and load within 10ms
- Support for loading javascript and CSS from remote server(s) during development
- Fixed some environments and adapted changes of the Espressif 8266 2.3.1 framework (Arduino Core 2.7.4)
- utf-8 support for web sockets
- Rewrite of the remote control plugin for faster response times and longer battery life
  - Removed support for home assistant Restful API
  - Option to send UDP packets to minimize latency
  - Deep sleep up to 30 days
  - 230ms WiFi Quick Connect, sending UDP packets
  - 300ms for MQTT over TCP
- LED Matrix plugin
- Cycling color and animation for rainbow mode (Clock/LED matrix)
- Reduce brightness depending on the temperature
- Added fire animation
- Configureable login security
- Fixed crash during login with login security disabled
- Option to save and restore brightness/other settings after reboot (Clock/LED Matrix plugin)
- Limit maximum power of the LEDs
- Support for rotary encoders with pushbutton and capacitive touch sensor
- MQTT device triggers for remote control
- Battery level indicator in % with charging detection
- MQTT callbacks for QoS
- Fully asynchronous MQTT auto discovery with incremental or full updates
- Upgrade to arduinoespressif8266 3.20704.0 including patch files for the platform
- JSON schema support for MQTT light
- Colored sub ranges for rangeslider.js
- Class to send Serial output over UDP
- Registered MQTT components are stored separately and do not require re-registering
- Added min. and max. range limits to reduce the dimmable range (Dimmer Plugin)
- Web server does not require re-registering web handlers and web sockets on reconfigure anymore
- Support for ArduinoOTA
- Max. deep sleep time increased to up to 31 days
- Replaced EspSaveCrash with own implementation that writes to flash storage directly without allocating any memory and supports multiple sectors
- Class to write to flash storage with copy on write/basic wear leveling
- 64/256KB flash storage that survives firmware and file system upgrades
- Replace read only files from WebUI by placing files in `/.wor/*`
- SaveCrash WebUI to download crash logs. MD5 checksum of the firmware is included
- Key Combo for safe mode and reset factory settings during boot
- Customized WString class
- Switch plugin fixes and improvements
- Replaced the JSON library with a more stable version that consumes less memory
- Switched to LittleFS
- Fixed missing information for SSDP
- Replaced RGB Silder with Bootstrap Color Picker Sliders
- Support for [https://github.com/NimmLor/IoT-Audio-Visualization-Center](https://github.com/NimmLor/IoT-Audio-Visualization-Center)
- Support for PCF8574 I2C IO-Expander
- Support for TinyPwm I2C IO-Expander [https://github.com/sascha432/TinyPwm](https://github.com/sascha432/TinyPwm)
- Fan control and light sensor for LED matrix
- Human readable uptime for MQTT system metrics
- User customizable options for factory reset over the WebUI
- OTA update tool restarts device in safe mode before running any updates
- Fixed play tone for blinds plugin
- Added framework-arduinoespressif8266 3.30000.210519 (3.0.0)
- Changes for GCC 10
- Support for interal or external RTC
- Improved NTP plugin

## Version 0.0.3

- Device configuration page for WebUI
- Option to turn status LED off when connected to WiFi
- Deep sleep support can be disabled
- Arduino ESP8266 2.6.3 release changes
- Support for MQTT component names instead of enumeration
- Conditional attributes for HTML forms
- Form validator for double
- Advanced firmware configuration for dimmer plugin
- Option to enable/disable mDNS
- Arduino ESP8266 2.7.1 release changes/fixes
- NTP startup delay reduced to 1 second (from up to 5 minutes)
- MQTT auto discovery queue to reduce memory usage and network load
- Send calibration/config. to MQTT for recovery after firmware updates
- MQTT auto discovery abbreviations
- MQTT auto discovery aggregates all entities as single device
- Replaced remote timezone with native POSIX timezone support

## Version 0.0.2

- Option to enable SoftAP only if WiFi station mode is not connected
- Option to disable the "WebUI" page
- Reboot after certain time if running in Safe Mode
- Restart WiFi subsystem once a minute if the connection failed
- Persistant message popups for the WebUI (WebAlerts)
- Multiple instances of Home Assistant supported
- Set mireds for Hass plugin
- Support for DHT11/22 sensor
- Store crash dumps in flash memory instead of EEPROM
- RestAPI class
- Replaced manual PROGMEM strings with ArduinoFlashStringGenerator
- Ambient light sensor for clock plugin
- WebUI/MMQT update rates seperated
- Support for INA219 sensor
- Improved MMQT TCP buffer handling
- MDNS service discovery for WebUI
- MDNS service queries
- MDNS version info and device name/title
- Improved WiFi quick connect performance by ~20%
- Disabled sending MQTT auto discovery after wake up
- Added device title
- Added bearer token for authentication (WebUI, web sockets, TCP2Serial...)
- Server side includes and extended HTML templates
- HLW8012 sensor update rate and precision improved
- Live view of HLW8012 sensor data via kfcfw_tool
- Cli OTA update tool for Flash, SPIFFS and ATmega flash images
- Dynamic menu for WebUI
- Support for RTC DS3231
- Support for espressif8266 2.3.2/arduino 2.6.3
- WiFi download speed test page for WebUI
- Export configuration as JSON
- Button groups for WebUI
- KFCGFx library with compressed canvas class to fit the contents of big TFTs in memory
- STK500 programmer for AVR over serial port via WiFi or from files stored on SPIFFS
- Support for CCS811 sensor
- Support for BME680 sensor
- Class to create JSON objects with streaming support with small buffer size
- Syslog over TCP support
- New virtual file system with reduced memory usage and long filenames
- WebUI "Reboot Device" checkbox "Safe Mode" fixed
- Fixed login issues with expired session cookie
- Fixed double menu entries after wake up from deep sleep
- Fixed invalid timezone/abbreviatation
- Fixed MDNS interface issues with SoftAP and station mode enabled
- Fixed missing SSID for WebUI WiFi scan
- Started to update change log

## Version 0.0.1

- Started to commit files
