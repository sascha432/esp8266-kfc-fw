<html>
    <head>
        <script type="text/javascript" src="../../lib/KFCWebBuilder/Resources/js/jquery-3.3.1.min.js"></script>
        <style type='text/css'>
            textarea {
                width: 100%;
                height: 300px;
                white-space: nowrap;
                overflow:    scroll;
                overflow-y:  hidden;
                overflow-x:  scroll;
                overflow:    -moz-scrollbars-horizontal;
            }
           </style>
    </head>
    <body>
        <div id="webui-group-title-content" class="__prototypes">
            <div class="{{column-type}}-12">
                <div class="webuicomponent title text-white bg-primary">
                    <div class="row group">
                        <div class="col-auto mr-auto">
                            <h1>{{title}}</h1>
                        </div>
                        {{webui-disconnected-icon}}
                        <div class="col-auto mb-auto mt-auto">
                            {{content}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="webui-group-title" class="__prototypes">
            <div class="{{column-type}}-12">
                <div class="webuicomponent title text-white bg-primary">
                    <div class="row group">
                        <div class="col-auto mr-auto mt-auto mb-auto">
                            <h1>{{title}}</h1>
                        </div>
                        {{webui-disconnected-icon}}
                    </div>
                </div>
            </div>
        </div>

        <div id="webui-disconnected-icon" class="__prototypes">
            <div class="col-auto lost-connection hidden" id="lost-connection">
                <span class="oi oi-bolt webui-disconnected-icon"></span>
            </div>
        </div>

        <div id="webui-row" class="__prototypes">
            <div class="row">
                {{content}}
            </div>
        </div>

        <div id="webui-col-12" class="__prototypes">
            <div class="{{column-type}}-12">
                <div class="webuicomponent">
                    {{content}}
                </div>
            </div>
        </div>

        <div id="webui-col-2" class="__prototypes">
            <div class="{{column-type}}-2">
                <div class="webuicomponent">
                    {{content}}
                </div>
            </div>
        </div>

        <div id="webui-col-3" class="__prototypes">
            <div class="{{column-type}}-3">
                <div class="webuicomponent">
                    {{content}}
                </div>
            </div>
        </div>

        <div id="webui-sensor-badge" class="__prototypes">
            <div class="webuicomponent">
                <div class="badge-sensor">
                    <div class="row">
                        <div class="col">
                            <div class="outer-badge">
                                <div class="inner-badge">
                                    <var value="{{hb|h4}}" class="data"><span id="{{id}}" class="value">{{value}}</span><space value=" "></space><span class="unit">{{unit}}</span></var>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col title">{{title}}</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="webui-sensor" class="__prototypes">
            <div class="webuicomponent">
                <div class="sensor">
                    <var value="{{ht|h}}" class="title">{{title}}</var>
                    <var value="{{hb|h1}}" class="data"><span id="{{id}}" class="value">{{value}}</span><space value=" "></space><span class="unit">{{unit}}</span></var>
                </div>
            </div>
        </div>

        <div id="webui-switch" class="__prototypes">
            <div class="switch">
                <input type="range" class="attribute-target">
            </div>
        </div>

        <div id="webui-named-switch" class="__prototypes">
            <div class="named-switch">
                <div class="row">
                    <div class="col"><input type="range" class="attribute-target"></div>
                </div>
                <div class="row">
                    <div class="col title">{{title}}</div>
                </div>

            </div>
        </div>

        <div id="webui-slider" class="__prototypes">
            <div class="webuicomponent">
                <div class="slider">
                    <input type="range" class="attribute-target">
                </div>
            </div>
        </div>

        <div id="webui-screen" class="__prototypes">
            <div class="webuicomponent">
                <div class="screen">
                    <div class="row">
                        <div class="col">
                            <canvas class="attribute-target"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <textarea id="prototypes" spellcheck="off"></textarea>

        <script>
            $(function() {
                //
                // replace all var tags with their value attribute
                // <var value="{{varname}}">...</var> = <{{varname}}>...</{{varname}}>
                // <var value="{{varname}}" attribute="...">...</var> = <{{varname}} attribute="...">...</{{varname}}>
                //
                function replace_var_tags(in_str) {
                    var values = [];
                    return in_str.replace(/<var\s+value=\"(?<value>[^\"]*)\"(?<attr>[^>]*)>/g, function(match, value, attr, offset, str) {
                        values.push(value);
                        return '<' + value + attr + '>';
                    }).replace(/<\/\s*var>/g, function(rep) {
                        return '</' + values.pop() + '>';
                    });
                };
                //
                // replace all space tags with their value attribute
                // allows to insert any text without beging trimmed
                //
                function replace_space_tags(in_str) {
                    return in_str.replace(/<space\s+value=\"(?<value>.*?)\"\s*>/g, function(match, value, offset, str) {
                        return value;
                    }).replace(/<\/\s*space>/g, '');
                };
                var prototypes = 'prototypes: {\n';
                $('.__prototypes').each(function() {
                    var html = $(this).html();
                    var name = $(this).attr('id');
                    name = name.replace(/-/g, '_');
                    html = html.replace(/"&gt;/g, '">');
                    html = html.replace(/\r/g, '');
                    html = html.replace(/\n+/g, ' ');
                    html = html.replace(/'/g, '\'');
                    html = html.replace(/&amp;/g, '&');
                    html = html.replace(/>\s+?</g, '><');
                    html = html.replace(/>\s+?{/g, '>{');
                    html = html.replace(/}\s+?</g, '}<');
                    html = html.trim();
                    html = html.replace(/<space\/>/g, '');
                    html = replace_var_tags(html);
                    html = replace_space_tags(html);
                    prototypes += '    ' + name + ': \'' + html + '\',\n';
                    console.log(html);
                });
                prototypes += '},\n';
                $('#prototypes').val(prototypes);
            });
        </script>
    </body>
</html>
