<!doctype html>
<html lang="en">
<!--%%HEAD-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" debug_loader="1">
    <link rel="stylesheet" href="../../lib/ESPWebFramework/Resources/css/bootstrap.min.css" debug_loader="1">
    <link rel="stylesheet" href="../css/styles.css" debug_loader="1">
    <link rel="stylesheet" href="../../lib/ESPWebFramework/Resources/css/open-iconic-bootstrap.css" debug_loader="1">
    <title>KFC FW</title>
</head>
<!--HEAD%%-->

<body>
    <!--%%NAV-->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="index.html">KFC FW</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
        </div>
    </nav>
    <!--NAV%%-->
    <div class="container">
        <h1>PIN Configuration</h1>
        <form method="POST" action="pins.html" id="pins_settings">
            <div class="form-group">
                <label for="led_type">Status LED</label>
                <select class="form-control" name="led_type" id="led_type">
                    <option value="0" %LED_TYPE_0%>Disable</option>
                    <option value="1" %LED_TYPE_1%>Single LED</option>
                    <option value="2" %LED_TYPE_2%>Red and Green</option>
                    <option value="3" %LED_TYPE_3%>RGB</option>
                </select>
            </div>
            <div class="card led_type_1 led_type_2 led_type_3 led_type_clr">
                <div class="card-body">
                    <span class="led_type_1 led_type_clr">
                        <div class="form-group">
                            <label for="led_pin">LED pin:</label>
                            <input type="text" class="form-control" name="led_pin" id="led_pin" value="%LED_PIN%">
                        </div>
                    </span>
                    <span class="led_type_2 led_type_3 led_type_clr">
                        <div class="form-group">
                            <label for="red_led_pin">Red LED pin:</label>
                            <input type="text" class="form-control" name="red_led_pin" id="red_led_pin" value="%RED_LED_PIN%">
                        </div>
                        <div class="form-group">
                            <label for="green_led_pin">Green LED pin:</label>
                            <input type="text" class="form-control" name="green_led_pin" id="green_led_pin" value="%GREEN_LED_PIN%">
                        </div>
                    </span>
                    <span class="led_type_3 led_type_clr">
                        <div class="form-group">
                            <label for="blue_led_pin">Blue LED pin:</label>
                            <input type="text" class="form-control" name="blue_led_pin" id="blue_led_pin" value="%BLUE_LED_PIN%">
                        </div>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label for="i2c_setup">I2C Bus</label>
                <select class="form-control" name="i2c" id="i2c">
                    <option value="0" %I2C_ENABLED_0%>Disable</option>
                    <option value="1" %I2C_ENABLED_1%>Enable</option>
                </select>
            </div>
            <div id="i2c_pins" class="card">
                <div class="card-body">
                    <div class="form-group">
                        <label for="sda">SDA Pin:</label>
                        <input type="text" class="form-control" name="sda" id="sda" value="%SDA_PIN">
                    </div>
                    <div class="form-group">
                        <label for="scl">SCL Pin:</label>
                        <input type="text" class="form-control" name="scl" id="scl" value="%SCL_PIN">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="spi_setup">SPI Bus</label>
                <select class="form-control" name="i2c" id="spi">
                    <option value="0" %SPI_ENALBED_0%>Disable</option>
                    <option value="1" %SPI_ENALBED_1%>Enable</option>
                </select>
            </div>
            <div id="spi_pins" class="card">
                <div class="card-body">
                    <div class="form-group">
                        <label for="miso">MISO:</label>
                        <input type="text" class="form-control" name="miso" id="miso" value="%MISO_PIN%">
                    </div>
                    <div class="form-group">
                        <label for="mosi">MOSI:</label>
                        <input type="text" class="form-control" name="mosi" id="mosi" value="%MOSI_PIN%">
                    </div>
                    <div class="form-group">
                        <label for="sck">SCK:</label>
                        <input type="text" class="form-control" name="sck" id="sck" value="%SCK_PIN%">
                    </div>
                    <div class="form-group">
                        <label for="spi_speed">Bus Speed:</label>
                        <input type="text" class="form-control" name="spi_speed" id="spi_speed" value="%SPI_SPEED%">
                    </div>
                    <div class="form-group">
                        <label for="spi_data_order">Data order:</label>
                        <select class="form-control" name="spi_data_order" id="spi_data_order">
                            <option value="0" %SPI_DATA_ORDER_0%>LSBFIRST</option>
                            <option value="1" %SPI_DATA_ORDER_1%>MSBFIRST</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="spi_data_mode">Data mode:</label>
                        <select class="form-control" name="spi_data_mode" id="spi_data_mode">
                            <option value="0" %SPI_DATA_MODE_0%>SPI_MODE0</option>
                            <option value="1" %SPI_DATA_MODE_1%>SPI_MODE1</option>
                            <option value="2" %SPI_DATA_MODE_2%>SPI_MODE2</option>
                            <option value="3" %SPI_DATA_MODE_2%>SPI_MODE3</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="serial1">Serial Port 1</label>
                <select class="form-control" name="serial1" id="serial1">
                    <option value="0" %SERIAL1_ENABLED_0%>Disable</option>
                    <option value="1" %SERIAL1_ENABLED_1%>Hardware Serial</option>
                    <option value="2" %SERIAL1_ENABLED_2%>Software Serial</option>
                </select>
            </div>
            <div id="serial1_pins" class="card">
                <div class="card-body">
                    <div class="form-group">
                        <label for="tx1">TX Pin:</label>
                        <input type="text" class="form-control" name="tx1" id="tx1" value="%SERIAL1_TX%">
                    </div>
                    <div class="form-group">
                        <label for="rx1">RX Pin:</label>
                        <input type="text" class="form-control" name="rx1" id="rx1" value="%SERIAL1_RX%">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="serial2">Serial Port 2</label>
                <select class="form-control" name="serial2" id="serial2">
                    <option value="0" %SERIAL2_ENABLED_0%>Disable</option>
                    <option value="1" %SERIAL2_ENABLED_1%>Hardware Serial</option>
                    <option value="2" %SERIAL2_ENABLED_2%>Software Serial</option>
                </select>
            </div>
            <div id="serial2_pins" class="card">
                <div class="card-body">
                    <div class="form-group">
                        <label for="tx2">TX Pin:</label>
                        <input type="text" class="form-control" name="tx2" id="tx2" value="%SERIAL2_TX%">
                    </div>
                    <div class="form-group">
                        <label for="rx2">RX Pin:</label>
                        <input type="text" class="form-control" name="rx2" id="rx2" value="%SERIAL2_RX%">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <button class="btn btn-outline-secondary" type="button" id="add_pin">Add Custom PIN...</button>
            </div>
            <span class="hidden" id="pin_prototype">
                <div class="form-row custom-pin-row" id="custom_pin_$NUM$">
                    <div class="form-group col-md-3">
                        <label for="pin$NUM$">PIN:</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <button class="btn btn-outline-secondary" type="button" id="remove_pin$NUM$">Remove...</button>
                            </div>
                            <input type="text" class="form-control" name="pin[]" id="pin$NUM$">
                        </div>

                    </div>
                    <div class="form-group col-md-2">
                        <label for="type$NUM$">Type</label>
                        <select class="form-control" name="type[]" id="type$NUM$">
                            <option value="0">Unused</option>
                            <option value="1">Input</option>
                            <option value="2">Output</option>
                            <option value="3">Push Button</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="options$NUM$">Options</label>
                        <select multiple class="form-control" name="options[]" id="options$NUM$" size="1">
                            <option value="101" class="type1">Internal pullup</option>
                            <option value="301" class="type3">Pressed when high</option>
                            <option value="302" class="type3">Pressed when low</option>
                            <option value="303" class="type3">Internal pullup</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="action$NUM$">Action/Trigger</label>
                        <select class="form-control" name="action[]" id="action$NUM$">
                            <option value="0">Disabled</option>
                            <option value="1">POSTBACK</option>
                            <option value="2">MQTT</option>
                            <option value="3" data-prefill="pin=&lt;PIN&gt;,action=&lt;set/toggle/PWM&gt;,value=&lt;high/low/pwm 0-255&gt;">Set
                                Output PIN</option>
                        </select>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="arguments$NUM$">Arguments</label>
                        <input type="text" class="form-control" name="arguments[]" id="arguments$NUM$">
                    </div>
                </div>
            </span>
            <span id="custom_pin_container">
            </span>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Save Changes...</button>
            </div>
        </form>
        <!--%%FOOT-->
        <div class="row">
            <div class="col footer">&nbsp;</div>
        </div>
        <!--FOOT%%-->
    </div>
    <!--%%JAVASCRIPT-->
	<script debug_loader="1" type="text/javascript" src="../../lib/ESPWebFramework/Resources/js/jquery-3.3.1.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../../lib/ESPWebFramework/Resources/js/popper.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../../lib/ESPWebFramework/Resources/js/popper.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../../lib/ESPWebFramework/Resources/js/bootstrap.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../../lib/ESPWebFramework/Resources/js/js.cookie.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../js/main.min.js"></script>
	<script debug_loader="1" type="text/javascript" src="../js/debug.js"></script>
    <!--JAVASCRIPT%%-->

    <script>
        $(function () {
            if ($('#pins_settings').length) {
                var custom_pin_num = 1;
                var custom_pins = [
                    { pin: 1, type: 1, action: 1, arguments: "y" },
                    { pin: 2, type: 1, action: 2, arguments: "" },
                ];
                function add_pin(pin, type, action, arguments) {
                    var current_custom_pin = custom_pin_num;
                    html = $('#pin_prototype').html().replace(new RegExp('$NUM$', 'g'), "" + custom_pin_num);
                    $('#custom_pin_container').append(html);
                    $('#remove_pin' + custom_pin_num).click(function () {
                        $(this).closest('.custom-pin-row').remove();
                    });
                    $('#action' + custom_pin_num).change(function () {
                        var arguments = $('#arguments' + current_custom_pin);
                        if (arguments.val() == "") {
                            arguments.val($(this).find('option[value="' + $(this).val() + '"]').data('prefill'));
                        }
                    });
                    $('#pin' + custom_pin_num).val(pin);
                    $('#type' + custom_pin_num).val(type);
                    $('#action' + custom_pin_num).val(action);
                    $('#arguments' + custom_pin_num).val(arguments);
                    custom_pin_num++;
                }
                function led_type_change() {
                    $('.led_type_clr').hide();
                    $('.led_type_' + $('#led_type').val()).show();
                }
                function i2c_change() {
                    if ($('#i2c').val() == "0") {
                        $('#i2c_pins').hide();
                    } else {
                        $('#i2c_pins').show();
                    }
                }
                function spi_change() {
                    if ($('#spi').val() == "0") {
                        $('#spi_pins').hide();
                    } else {
                        $('#spi_pins').show();
                    }
                }
                function serial1_change() {
                    if ($('#serial1').val() == "2") {
                        $('#serial1_pins').show();
                    } else {
                        $('#serial1_pins').hide();
                    }
                }
                function serial2_change() {
                    if ($('#serial2').val() == "2") {
                        $('#serial2_pins').show();
                    } else {
                        $('#serial2_pins').hide();
                    }
                }
                $(custom_pins).each(function () {
                    add_pin(this.pin, this.type, this.action, this.argumens);
                });
                $('#led_type').change(led_type_change);
                $('#i2c').change(i2c_change);
                $('#spi').change(spi_change);
                $('#serial1').change(serial1_change);
                $('#serial2').change(serial2_change);
                $('#add_pin').click(function () {
                    add_pin("", 0, 0, "");
                });
                led_type_change();
                i2c_change();
                serial1_change();
                serial2_change();
                spi_change();
            }
        });
    </script>
</body>
</html>
