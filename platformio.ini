; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

; Platform IO 4.0

[platformio]
; default_envs=atomic_sun
default_envs=atomic_sunv2.1
; default_envs=1ch_dimmer
; default_envs=1ch_dim_pm
; default_envs=1ch_dim_pm_h
; default_envs=1ch_dim_pm_l
; default_envs=blindsctrl
; default_envs=blindsctrl_79
; default_envs=blindsctrl_81
; default_envs=weather
; default_envs=ws_95
; default_envs=ws_99
; default_envs=ws_101
; default_envs=remote
; default_envs=rlybrd
; default_envs=bme280
; default_envs=sonoffb
; default_envs=clock
; default_envs=clockv2
; default_envs=esp8266heltec_wifi_kit_8
; default_envs=esp32

; -------------------------------------------------------------------------
;  shared env
[env]
; platform = espressif8266@2.2.3
platform = espressif8266
framework = arduino

monitor_filters = esp8266_exception_decoder

board = nodemcu
board_build.flash_mode = dio
upload_speed = 921600
monitor_speed = 115200
monitor_rts = 0
monitor_dtr = 0
upload_protocol = esptool

lib_ignore = atmelavrStreamString

; run "pio run -t buildspgm" to rebuild the flash strings

extra_scripts =
    ../ArduinoFlashStringGenerator/scripts/extra_script.py
    lib/KFCWebBuilder/scripts/extra_script.py
    scripts/extra_script.py

; additonal include directories that are processed by sub parsers
; missing include files are skipped, but if those do not contain any flash strings or defines used in flash strings, it does not affect the output
custom_spgm_generator.include_path =
    ${platformio.packages_dir}/toolchain-xtensa/bin/../lib/gcc/xtensa-lx106-elf/4.8.2/include
    ${platformio.packages_dir}/toolchain-xtensa/bin/../lib/gcc/xtensa-lx106-elf/4.8.2/include-fixed
    ${platformio.packages_dir}/toolchain-xtensa/bin/../lib/gcc/xtensa-lx106-elf/4.8.2/../../../../xtensa-lx106-elf/include
    ${platformio.packages_dir}/toolchain-xtensa/xtensa-lx106-elf/include
    ${platformio.packages_dir}/toolchain-xtensa/xtensa-lx106-elf/include/c++/4.8.2
    ${platformio.packages_dir}/toolchain-xtensa/xtensa-lx106-elf/include/c++/4.8.2/xtensa-lx106-elf

custom_spgm_generator.output_dir = ${platformio.src_dir}/generated
custom_spgm_generator.extra_args =
    --source-dir=${platformio.lib_dir}
    --src-filter-include=../lib/*
    --src-filter-exclude=../lib/*/tests/*
    --src-filter-exclude=../lib/*/mock/*
    --src-filter-exclude=../lib/*/example/*
    --src-filter-exclude=${platformio.packages_dir}/framework-arduinoespressif8266/libraries/ESP8266mDNS/src/LEAmDNS.h
    --src-filter-exclude=${platformio.packages_dir}/toolchain-xtensa/xtensa-lx106-elf/include/c++/4.8.2/forward_list
    --include-file=Arduino_compat.h
    -D__cplusplus=201103L
    -D__AVR__=1

    ; --src-filter-exclude=../lib/KFCBaseLibrary/tests/*
    ; --src-filter-exclude=../lib/KFCGfx/mock/*
    ; --src-filter-exclude=../lib/KFCGfx/tests/*
    ; --src-filter-exclude=../lib/KFCJson/example/*
    ; --src-filter-exclude=../lib/KFCConfiguration/tests/*
    ; --src-filter-exclude=../lib/KFCOpenWeather/tests/*
    ; --src-filter-exclude=../lib/KFCResetDetector/tests/*

; -------------------------------------------------------------------------
[common]

upload_command = $PYTHONEXE ./scripts/tools/kfcfw_ota.py --no-wait --no-status $UPLOAD_FLAGS

lib_deps =
    https://github.com/sascha432/ESPAsyncWebServer.git
    https://github.com/sascha432/async-mqtt-client.git
    Crypto
    https://github.com/sascha432/ArduinoFlashStringGenerator
    https://github.com/sascha432/i2c_uart_bridge
    https://github.com/sascha432/libcrc16.git

src_filter =
    ${env.src_filter}
    -<../src/plugins/>
    +<../src/plugins/file_manager/>
    +<../src/plugins/ntp/>
    +<../src/plugins/mdns/>
    +<../src/generated/>

build_flags =
    -I./include
    -I./lib/KFCJson/include
    -D CONFIG_MAGIC_DWORD=0x72a82166
    -D CUSTOM_CONFIG_PRESET=1
    -D HAVE_PROGMEM_DATA=1
    -D SPIFFS_SUPPORT=1
    -D MINIFY_WEBUI=1
    -D LOGGER=1
    ; -D LOGGER=0
    ; -D FILE_MANAGER=0
    ; -D NTP_CLIENT=0
    -D FILE_MANAGER=1
    -D NTP_CLIENT=1
    -D SNTP_STARTUP_DELAY=1
    -D SNTP_STARTUP_DELAY_MAX_TIME=1000UL
    -D WEBSERVER_SUPPORT=1
    -D HAVE_EXTERN_GET_CONTENT_TYPE_FUNCTION=1
    -D FORM_DATA_CLASS_OVERRIDE=1
    -D MQTT_AUTO_DISCOVERY_USE_ABBREVIATIONS=1
    -D MQTT_AUTO_DISCOVERY=1
    -D HAVE_KFC_PLUGINS=1
    -D SERIALTWOWIRE_NO_GLOBALS=1
    -D SERIALTWOWIRE_USE_BUFFERSTREAM=1
    -D SPEED_TEST_NO_AUTH=1
    -D KFC_RESTAPI_ENDPOINT=\"/api/\"
    ; -D KFC_TWOWIRE_SDA=SDA
    ; -D KFC_TWOWIRE_SCL=SCL
    -D KFC_TWOWIRE_CLOCK_STRETCH=45000
    ; required for espressif8266@1.8.0
    ; -I./lib/sprintf_wrapper/include
    ; -Wl,--wrap=snprintf
    ; -Wl,--wrap=vsnprintf
    ; -Wl,--wrap=snprintf_P
    ; -Wl,--wrap=vsnprintf_P
    ; -D PRINTF_WRAPPER_ENABLED=1
    -D WEBUI_ALERTS_ENABLED=0

; -------------------------------------------------------------------------
[env_pin_debugger]

build_flags =
    ; -Wl,--wrap=analogWrite
    ; -Wl,--wrap=analogRead
    ; -Wl,--wrap=digitalWrite
    -Wl,--wrap=digitalRead
    ; -Wl,--wrap=pinMode
    ; -Wl,--wrap=attachInterrupt
    ; -Wl,--wrap=attachScheduledInterrupt
    ; -Wl,--wrap=detachInterrupt
    -D PIN_DEBUGGER=1

; -------------------------------------------------------------------------
[env_esp8266]

src_filter = ${common.src_filter}

lib_deps =
    https://github.com/sascha432/ESPAsyncTCP.git
    ESP8266WiFi
    asyncHTTPrequest
    https://github.com/sascha432/EspSaveCrash
    https://github.com/sascha432/AsyncPing
    ${common.lib_deps}

build_flags =
    ${common.build_flags}
    -D ESP8266=1
    ; -Wl,--wrap=settimeofday ; required for for 2.6.3


# increase SPIFFS to a maximum if writing frequently, otherwise the flash might wear out early while the unused part is fully intact

# allows OTA with up to ~1028KB
board_build.ldscript = ./ld/eagle.flash.4m2m.ld
# allows OTA with up to ~2052KB
#board_build.ldscript = ./ld/eagle.flash.4m1m.ld

; -------------------------------------------------------------------------
[env_esp32]

src_filter = ${common.src_filter}

lib_deps =
    AsyncTCP
    HTTPClient
    WiFiClientSecure
    ${common.lib_deps}

build_flags =
    ${common.build_flags}
    -D ESP32=1
    -Wl,--wrap=settimeofday

; -------------------------------------------------------------------------
[debug]

lib_deps = ${common.lib_deps}

build_flags =
    -Og -ggdb
    -D GCC_OPTIMIZE_LEVEL=4
    -D ENABLE_GDB=1
    -D DEBUG=1
    -D DEBUG_OUTPUT=DebugSerial
    -D KFC_SERIAL_PORT=Serial
    -D KFC_SAFE_MODE_SERIAL_PORT=KFC_SERIAL_PORT
    -D DEBUG_USE_SYSLOG=0
    -D DEBUG_INCLUDE_SOURCE_INFO=1
    -D HAVE_FS_FILE_OPEN_MODE=1
    -D SAVE_CRASH_EEPROM_OFFSET=0
    -D SAVE_CRASH_SPACE_SIZE=4096
    -D SAVE_CRASH_FLASH_SECTOR=_ESPSAVECRASH_start
    -D SAVE_CRASH_HAVE_CALLBACKS=1

; -------------------------------------------------------------------------
[release]

lib_deps = ${common.lib_deps}

build_flags =
    -O3
    -D GCC_OPTIMIZE_LEVEL=3
    -D ENABLE_GDB=0
    -D DEBUG=0
    -D DEBUG_OUTPUT=DebugSerial
    -D KFC_SERIAL_PORT=Serial
    -D KFC_SAFE_MODE_SERIAL_PORT=KFC_SERIAL_PORT
    -D DEBUG_USE_SYSLOG=0
    -D DEBUG_INCLUDE_SOURCE_INFO=0
    -D DEBUG_HAVE_SAVECRASH=1

; -------------------------------------------------------------------------
; esp8266 shared debug env
; debug_esp8266 -> env_esp8266 -> common, debug
[debug_esp8266]

src_filter = ${env_esp8266.src_filter}

lib_deps = ${debug.lib_deps} ${env_esp8266.lib_deps}

build_flags = ${debug.build_flags} ${env_esp8266.build_flags}
    -D DEBUG_HAVE_SAVECRASH=1

; -------------------------------------------------------------------------
; esp8266 shared release env
; release_esp8266 -> env_esp8266 -> common, release
[release_esp8266]

src_filter = ${env_esp8266.src_filter}

lib_deps = ${release.lib_deps} ${env_esp8266.lib_deps}

build_flags = ${release.build_flags} ${env_esp8266.build_flags}
    -D DEBUG_HAVE_SAVECRASH=1

; -------------------------------------------------------------------------
; esp32 shared debug env
; debug_esp32 -> env_esp32 -> common, release
[debug_esp32]

src_filter = ${env_esp32.src_filter}

lib_deps = ${debug.lib_deps} ${env_esp32.lib_deps}

build_flags = ${debug.build_flags} ${env_esp32.build_flags}
    -D DEBUG_HAVE_SAVECRASH=0

; -------------------------------------------------------------------------
; esp32 shared release env
; release_esp32 -> env_esp32 -> common, release
[release_esp32]

src_filter = ${env_esp32.src_filter}

lib_deps = ${release.lib_deps} ${env_esp32.lib_deps}

build_flags = ${release.build_flags} ${env_esp32.build_flags}
    -D DEBUG_HAVE_SAVECRASH=0

; -------------------------------------------------------------------------
; debug esp8266 GDBSTUB
[debug_esp8266_gdbstub]

build_flags =
    -D GDBSTUB_FREERTOS=0
    -D GDBSTUB_USE_OWN_STACK=0
    -D GDBSTUB_CTRLC_BREAK=1
    -D GDBSTUB_REDIRECT_CONSOLE_OUTPUT=1
    -D GDBSTUB_BREAK_ON_INIT=0
    -D HAVE_GDBSTUB=1
    ; -D DEBUG_ESP_PORT=Serial
    ; -D DEBUG_ESP_CORE
    ; -D DEBUG_ESP_WIFI
    ; -D DEBUG_ESP_OOM
    ; -D DEBUG_ESP_SSL
    ; -D DEBUG_ESP_TLS_MEM
    ; -D DEBUG_ESP_HTTP_CLIENT
    ; -D DEBUG_ESP_HTTP_SERVER
    ; -D DEBUG_ESP_HTTP_UPDATE
    ; -D DEBUG_ESP_UPDATER
    ; -D DEBUG_ESP_4
    ; -D DEBUG_ESP_OOM -include "umm_malloc/umm_malloc_cfg.h"

; -------------------------------------------------------------------------
; enable all debugging
[debug_kfc_all]

build_flags =
    -D DEBUG_WEB_SERVER=1
    -D DEBUG_KFC_CONFIG=1
    -D DEBUG_CONFIGURATION=1
    -D DEBUG_PLUGINS=1
    -D DEBUG_MDNS_SD=1
    -D DEBUG_KFC_JSON=1
    -D DEBUG_SSD1306_PLUGIN=1
    -D DEBUG_AT_MODE=1
    -D DEBUG_TEMPLATES=1
    -D DEBUG_LOGGER=1
    -D DEBUG_SERIAL_HANDLER=1
    -D DEBUG_ASYNC_WEB_RESPONSE=1
    -D DEBUG_WEB_SOCKETS=1
    -D DEBUG_EVENT_SCHEDULER=1
    -D DEBUG_LOOP_FUNCTIONS=1
    -D DEBUG_OSTIMER=1
    -D DEBUG_WIFICALLBACKS=1
    -D DEBUG_RESET_DETECTOR=1
    -D DEBUG_RTC_MEMORY_MANAGER=1
    -D DEBUG_SYSLOG=1
    -D DEBUG_BOOTSTRAP_MENU=1
    -D DEBUG_KFC_FORMS=1
    -D DEBUG_HOME_ASSISTANT=1
    -D DEBUG_WEBUI=1
    -D DEBUG_MDNS_SD=1
    -D DEBUG_MQTT_CLIENT=1
    -D DEBUG_MQTT_AUTO_DISCOVERY_QUEUE=1
    -D DEBUG_HTTP2SERIAL=1
    -D DEBUG_FILE_MANAGER=1
    -D DEBUG_NTP_CLIENT=1
    -D DEBUG_PING_MONITOR=1
    -D DEBUG_REMOTE_TIMEZONE=1
    -D DEBUG_SERIAL2TCP=1
    -D DEBUG_4CH_DIMMER=1
    -D DEBUG_SSD1306_PLUGIN=1
    -D DEBUG_PIN_MONITOR=1
    -D DEBUG_IOT_BUTTONS=1
    -D DEBUG_IOT_DIMMER_MODULE=1
    -D DEBUG_IOT_SENSOR=1
    -D DEBUG_IOT_SWITCH=1
    -D DEBUG_PIN_MONITOR=1
    -D DEBUG_SERIAL2TCP=1
    -D DEBUG_STK500V1=1
    -D DEBUG_IOT_BLINDS_CTRL=1
    -D DEBUG_IOT_RF24=1
    -D DEBUG_IOT_WEATHER_STATION=1
    -D DEBUG_IOT_CLOCK=1
    -D DEBUG_IOT_REMOTE_CONTROL=1
    -D DEBUG_KFC_REST_API=1
    -D DEBUG_HOME_ASSISTANT=1
    -D DEBUG_WEBUI_ALERTS=1

; -------------------------------------------------------------------------
[lib_buttons]

lib_deps =
    Bounce2
    r89m Buttons
    r89m PushButton

; -------------------------------------------------------------------------
[lib_sensors]

lib_deps =
    Adafruit Unified Sensor
    Adafruit BME280 Library
    Adafruit BMP280 Library
    https://github.com/adafruit/Adafruit_CCS811.git

; -------------------------------------------------------------------------
; weather station
; -------------------------------------------------------------------------

[env:weather]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/weather_station/>
    +<../src/plugins/sensor/>

lib_ignore = ${env.lib_ignore}
    SD
    Adafruit TouchScreen
    Adafruit ADXL343
    Adafruit ILI9341
    Adafruit STMPE610
    Adafruit seesaw Library
    Adafruit TouchScreen
    TinyWireM

lib_deps =
    Adafruit Unified Sensor
    Adafruit BME280 Library
    https://github.com/sascha432/Adafruit-GFX-Library.git
    https://github.com/adafruit/Adafruit-ST7735-Library
    https://github.com/adafruit/RTClib
    https://github.com/adafruit/Adafruit_MPR121
    ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=-3
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D ASYNC_TCP_SSL_ENABLED=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Weather\ Station\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_WEATHER_STATION=1
    -D HAVE_NEOPIXEL=1
    -D RTC_SUPPORT=1
    -D RTC_DEVICE_DS3231=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_DS3231=1
    -D IOT_SENSOR_HAVE_LM75A=0x48
    -D IOT_SENSOR_HAVE_BME280=0x76
    -D IOT_SENSOR_HAVE_BATTERY=1
    -D IOT_SENSOR_NAMES_BATTERY=\"Supply\ Voltage\"
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R1=22.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R2=1000.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_CALIBRATION=1.0
    -D IOT_SENSOR_BATTERY_CHARGE_DETECTION=0
    -D IOT_WEATHER_STATION_HAS_TOUCHPAD=1
    -D KFC_TWOWIRE_SDA=0
    -D KFC_TWOWIRE_SCL=2
    -D HAVE_KFCGFXLIB=1
    -D __LED_BUILTIN_WS2812_NUM_LEDS=3
    -D __LED_BUILTIN_WS2812_PIN=16
    -D TFT_PIN_LED=15

[env:ws_95]
extends = env:weather
upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFCDABF32:12345678@192.168.0.95

[env:ws_99]
extends = env:weather
upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFC736379:12345678@192.168.0.99
; upload_speed = 921600
; monitor_speed = 115200
; board = esp12e

[env:ws_101]
extends = env:weather
upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFCE1211C:12345678@192.168.0.101
build_flags =
    ${env:weather.build_flags}
    -D IOT_WEATHER_STATION_WS2812_NUM=1

; -------------------------------------------------------------------------
; remote
; -------------------------------------------------------------------------

[env:remote]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/sensor/>
    +<../src/plugins/home_assistant/>
    +<../src/plugins/remote/>

lib_deps = ${debug_esp8266.lib_deps} ${lib_buttons.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D ASYNC_TCP_SSL_ENABLED=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Remote\ Control\"
    -D MQTT_SET_LAST_WILL=0
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D LOAD_STATISTICS=0
    -D ENABLE_DEEP_SLEEP=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_BATTERY=1
    -D IOT_SENSOR_NAMES_BATTERY=\"Battery\ Voltage\"
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R1=75.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R2=330.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_CALIBRATION=1.0
    -D IOT_SENSOR_BATTERY_CHARGE_DETECTION=5
    -D PLUGIN_DEEP_SLEEP_DELAYED_START_TIME=6000
    -D SPEED_BOOSTER_ENABLED=0
    -D HOME_ASSISTANT_INTEGRATION=1
    -D IOT_REMOTE_CONTROL=1
    ; -D IOT_REMOTE_CONTROL_BUTTON_COUNT=1
    ; -D IOT_REMOTE_CONTROL_BUTTON_PINS={14}

; -------------------------------------------------------------------------
; 7 segment clock
; -------------------------------------------------------------------------

[env:clock]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter = ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/clock/>

lib_deps =
    Adafruit Unified Sensor
    Adafruit BME280 Library
    https://github.com/sascha432/Adafruit_INA219
    https://github.com/adafruit/Adafruit_NeoPixel
    https://github.com/adafruit/RTClib
    ${debug_esp8266.lib_deps}
    ${lib_buttons.lib_deps}

lib_ignore = ${env.lib_ignore}
    TinyWireM

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Clock\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_LM75A=0x48
    -D IOT_SENSOR_HAVE_BME280=0x76
    -D IOT_SENSOR_HAVE_BATTERY=1
    -D IOT_SENSOR_HAVE_INA219=0x40
    -D IOT_SENSOR_INA219_R_SHUNT=0.03148
    -D IOT_SENSOR_INA219_BUS_URANGE=INA219_CONFIG_BVOLTAGERANGE_16V
    -D IOT_SENSOR_INA219_GAIN=INA219_CONFIG_GAIN_4_160MV
    -D IOT_SENSOR_HAVE_DS3231=1
    -D IOT_SENSOR_NAMES_BATTERY=\"Supply\ Voltage\"
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R1=22.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_R2=1000.0
    -D IOT_SENSOR_BATTERY_VOLTAGE_DIVIDER_CALIBRATION=0.9685599232493649
    -D IOT_SENSOR_BATTERY_CHARGE_DETECTION=0
    -D SPEED_BOOSTER_ENABLED=0
    -D IOT_CLOCK=1
    -D IOT_CLOCK_NEOPIXEL=1
    -D IOT_CLOCK_LED_PIN=12
    -D KFC_TWOWIRE_SDA=5
    -D KFC_TWOWIRE_SCL=4
    -D DEBUG_IOT_CLOCK=1
    -D RTC_SUPPORT=1
    -D RTC_DEVICE_DS3231=1
    -D NTP_HAVE_CALLBACKS=1
    -D I2CSCANNER_PLUGIN=1

; -------------------------------------------------------------------------
; 7 segment clock v2
; -------------------------------------------------------------------------

[env:clockv2]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/sensor/>
    +<../src/plugins/clock/>

lib_ignore = ${env.lib_ignore}
    Adafruit ADXL343
    TinyWireM

lib_deps =
    Adafruit Unified Sensor
    https://github.com/sascha432/Adafruit_INA219
    https://github.com/FastLED/FastLED.git
    https://github.com/adafruit/RTClib
    ${debug_esp8266.lib_deps}
    ${lib_buttons.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Clock\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_LM75A=0x48
    -D IOT_SENSOR_HAVE_DS3231=1
    -D IOT_SENSOR_HAVE_INA219=0x40
    -D IOT_SENSOR_INA219_R_SHUNT=0.016172608
    -D IOT_SENSOR_INA219_BUS_URANGE=INA219_CONFIG_BVOLTAGERANGE_32V
    -D IOT_SENSOR_INA219_GAIN=INA219_CONFIG_GAIN_2_80MV
    -D IOT_CLOCK=1
    -D IOT_CLOCK_NEOPIXEL=0
    -D IOT_CLOCK_LED_PIN=12
    -D IOT_CLOCK_FASTLED_CHIPSET=NEOPIXEL
    -D FASTLED_ESP8266_RAW_PIN_ORDER=1
    -D IOT_CLOCK_NUM_DIGITS=4
    -D IOT_CLOCK_NUM_PIXELS=4
    -D IOT_CLOCK_NUM_COLONS=1
    -D IOT_CLOCK_NUM_COLON_PIXELS=2
    -D IOT_CLOCK_PIXEL_ANIMATION_ORDER_LEN=32
    -D IOT_CLOCK_PIXEL_ANIMATION_ORDER={28,29,30,31,24,25,26,27,11,10,9,8,20,21,22,23,16,17,18,19,15,14,13,12,11,10,9,8,7,6,5,4}
    -D IOT_CLOCK_SEGMENT_ORDER={6,5,2,3,4,0,1}
    -D IOT_CLOCK_DIGIT_ORDER={30,2,3,1,0}
    -D IOT_CLOCK_BUTTON_PIN=0
    -D SPEED_BOOSTER_ENABLED=0
    -D KFC_TWOWIRE_SDA=4
    -D KFC_TWOWIRE_SCL=5
    -D RTC_SUPPORT=1
    -D RTC_DEVICE_DS3231=1
    -D NTP_HAVE_CALLBACKS=1

upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFCE120D0:12345678@192.168.0.100

; -------------------------------------------------------------------------
; 4 channel relay board
; -------------------------------------------------------------------------

[env:rlybrd]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/switch/>

lib_deps = ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_SWITCH=1
    -D IOT_SWITCH_ON_STATE=HIGH
    -D IOT_SWITCH_CHANNEL_NUM=7
    -D IOT_SWITCH_CHANNEL_PINS=15,16,13,12,14,0,2

; -------------------------------------------------------------------------
; BME280 sensor
; -------------------------------------------------------------------------

[env:bme280]

board_build.ldscript = ${env_esp8266.board_build.ldscript}
board = esp01

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/sensor/>
    ; +<../src/plugins/switch/>
    ; +<../src/plugins/i2c_scanner/>

lib_deps =
    Adafruit Unified Sensor
    Adafruit BME280 Library
    Wire
    SPI
    SimpleDHT
    ${debug_esp8266.lib_deps}

lib_ignore = ${env.lib_ignore}
    Adafruit ADXL343
    Adafruit BusIO
    TinyWireM

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=-1
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Environmental\ Sensor\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_BME280=0x76
    ; -D IOT_SENSOR_HAVE_LM75A=0x4c
    ; -D IOT_SENSOR_HAVE_DHTxx=11
    ; -D IOT_SENSOR_HAVE_DHTxx_PIN=5
    -D SPEED_BOOSTER_ENABLED=0
    -D KFC_TWOWIRE_SDA=0
    -D KFC_TWOWIRE_SCL=2
    ; -D IOT_SWITCH=1
    ; -D IOT_SWITCH_ON_STATE=HIGH
    ; -D IOT_SWITCH_CHANNEL_NUM=1
    ; -D IOT_SWITCH_CHANNEL_PINS=12
    ; -D I2CSCANNER_PLUGIN=1

; -------------------------------------------------------------------------
; SONOFF Basic
; -------------------------------------------------------------------------

[env:sonoffb]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${release_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/switch/>

lib_deps = ${release_esp8266.lib_deps}

build_flags =
    ${release_esp8266.build_flags}
    -D __LED_BUILTIN=13
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Sonoff\ Basic\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_SWITCH=1
    -D IOT_SWITCH_ON_STATE=HIGH
    -D IOT_SWITCH_CHANNEL_NUM=1
    -D IOT_SWITCH_CHANNEL_PINS=12

; -------------------------------------------------------------------------
; 1 channel dimmer
; -------------------------------------------------------------------------

[env:1ch_dimmer]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/sensor/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/dimmer_module/>
    +<../src/plugins/stk500v1/>

lib_deps =
    ${debug_esp8266.lib_deps}
    ${lib_buttons.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D KFC_SERIAL_RATE=57600
    -D IOT_DIMMER_MODULE=1
    -D IOT_DIMMER_MODULE_CHANNELS=1
    -D IOT_DIMMER_MODULE_INTERFACE_UART=1
    -D IOT_DIMMER_MODULE_BAUD_RATE=KFC_SERIAL_RATE
    -D IOT_DIMMER_MODULE_MAX_BRIGHTNESS=8333
    -D IOT_DIMMER_MODULE_HAS_BUTTONS=1
    -D IOT_DIMMER_MODULE_PINMODE=INPUT
    -D IOT_SWITCH_ACTIVE_STATE=PRESSED_WHEN_LOW
    -D PIN_MONITOR=1
    -D STK500V1=1
    -D STK500V1_RESET_PIN=D1
    -D DEBUG_STK500V1=1

upload_speed = 921600
monitor_speed = 57600

; -------------------------------------------------------------------------
; 1 channel dimmer with power monitor
; -------------------------------------------------------------------------

[env:1ch_dim_pm]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/dimmer_module/>
    +<../src/plugins/sensor/>
    +<../src/plugins/stk500v1/>

lib_deps =
    ${debug_esp8266.lib_deps}
    ${lib_buttons.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D KFC_SERIAL_RATE=57600
    -D IOT_DIMMER_MODULE=1
    -D IOT_DIMMER_MODULE_CHANNELS=1
    -D IOT_DIMMER_MODULE_INTERFACE_UART=1
    -D IOT_DIMMER_MODULE_BAUD_RATE=KFC_SERIAL_RATE
    -D IOT_DIMMER_MODULE_MAX_BRIGHTNESS=8333
    -D IOT_DIMMER_MODULE_HAS_BUTTONS=1
    -D IOT_DIMMER_MODULE_PINMODE=INPUT
    ; -D IOT_SWITCH_ACTIVE_STATE=PRESSED_WHEN_LOW
    -D PIN_MONITOR=1
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_HLW8012=1
    -D IOT_SENSOR_NAMES_HLW8012=\"\"
    -D IOT_SENSOR_HLW80xx_ADJUST_CURRENT=1
    -D STK500V1=1
    -D STK500V1_RESET_PIN=D1
    -D DEBUG_STK500V1=1
     ${sysenv.EXTRA_BUILD_FLAGS}

upload_speed = 921600
monitor_speed = 57600


[env:1ch_dim_pm_l]
extends = env:1ch_dim_pm

build_flags =
    ${env:1ch_dim_pm.build_flags}
    -D IOT_SWITCH_ACTIVE_STATE=PRESSED_WHEN_LOW

[env:1ch_dim_pm_h]
extends = env:1ch_dim_pm

build_flags =
    ${env:1ch_dim_pm.build_flags}
    -D IOT_SWITCH_ACTIVE_STATE=PRESSED_WHEN_HIGH

; -------------------------------------------------------------------------
; atomic sun 4 channel dimmer
; -------------------------------------------------------------------------

[env:atomic_sun]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/atomic_sun/>
    +<../src/plugins/dimmer_module/dimmer_base.cpp>
    +<../src/plugins/dimmer_module/dimmer_module_form.cpp>
    +<../src/plugins/stk500v1/>

lib_deps =
    ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Atomic\ Sun\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D KFC_SERIAL_RATE=57600
    -D IOT_ATOMIC_SUN_V2=1
    -D IOT_DIMMER_MODULE_INTERFACE_UART=1
    -D IOT_DIMMER_MODULE_BAUD_RATE=KFC_SERIAL_RATE
    -D IOT_DIMMER_MODULE_MAX_BRIGHTNESS=8333
    -D DEBUG_4CH_DIMMER=1
    -D DEBUG_IOT_DIMMER_MODULE=1
    -D STK500V1=1
    -D STK500V1_RESET_PIN=D1

upload_speed = 921600
monitor_speed = 57600

; -------------------------------------------------------------------------
; atomic sun 4 channel dimmer v2.1 with energy monitor
; -------------------------------------------------------------------------

[env:atomic_sunv2.1]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/atomic_sun/>
    +<../src/plugins/dimmer_module/dimmer_base.cpp>
    +<../src/plugins/dimmer_module/dimmer_module_form.cpp>
    +<../src/plugins/sensor/>
    +<../src/plugins/stk500v1/>

lib_deps =
    ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Atomic\ Sun\ V2.1\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D KFC_SERIAL_RATE=57600
    -D IOT_ATOMIC_SUN_V2=1
    -D IOT_ATOMIC_SUN_V2_1=1
    -D IOT_DIMMER_MODULE_INTERFACE_UART=1
    -D IOT_DIMMER_MODULE_BAUD_RATE=KFC_SERIAL_RATE
    -D IOT_DIMMER_MODULE_MAX_BRIGHTNESS=8333
    -D IOT_ATOMIC_SUN_CHANNEL_WW1=3
    -D IOT_ATOMIC_SUN_CHANNEL_WW2=2
    -D IOT_ATOMIC_SUN_CHANNEL_CW1=1
    -D IOT_ATOMIC_SUN_CHANNEL_CW2=0
    -D IOT_SENSOR=1
    -D IOT_SENSOR_HAVE_HLW8012=1
    -D IOT_SENSOR_NAMES_HLW8012=\"\"
    -D IOT_SENSOR_HLW80xx_ADJUST_CURRENT=1
    -D IOT_SENSOR_HLW80xx_SHUNT=0.005
    -D IOT_SENSOR_HLW80xx_V_RES_DIV=((4*510)/1.0)
    -D IOT_SENSOR_HLW8012_CF=12
    -D IOT_SENSOR_HLW8012_CF1=14
    -D IOT_SENSOR_HLW8012_SEL_VOLTAGE=HIGH
    -D IOT_SENSOR_HLW8012_SEL_CURRENT=LOW
    -D STK500V1=1
    -D STK500V1_RESET_PIN=D1

; upload_protocol = espota
; upload_command = ${common.upload_command}
; upload_port = KFCDAA6F2:12345678@192.168.0.97
upload_speed = 921600
monitor_speed = 57600
board = esp12e

; -------------------------------------------------------------------------
; blinds controller
; -------------------------------------------------------------------------

[env:blindsctrl]

board_build.ldscript = ${env_esp8266.board_build.ldscript}

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ping_monitor/>
    +<../src/plugins/blinds_ctrl/>

lib_deps = ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=2
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D MQTT_AUTO_DISCOVERY_MODEL=\"Motorized\ Blinds\"
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=1
    -D PING_MONITOR=1
    -D IOT_BLINDS_CTRL=1
    -D DEBUG_IOT_BLINDS_CTRL=1

[env:blindsctrl_79]
extends = env:blindsctrl

upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFCD6ECD8:12345678@192.168.0.79

[env:blindsctrl_81]
extends = env:blindsctrl

upload_protocol = espota
upload_command = ${common.upload_command}
upload_port = KFC4F195D:12345678@192.168.0.81

; -------------------------------------------------------------------------
; esp8266 test
; -------------------------------------------------------------------------

[env:esp8266heltec_wifi_kit_8]

board_build.ldscript = ${env_esp8266.board_build.ldscript}
board = heltec_wifi_kit_8

src_filter =
    ${debug_esp8266.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/ssd1306_plugin/>

lib_deps = ${debug_esp8266.lib_deps}

build_flags =
    ${debug_esp8266.build_flags}
    -D __LED_BUILTIN=-1
    -D INVERT_BUILTIN_LED=1
    -D SYSLOG=1
    -UNTP_CLIENT
    -D NTP_CLIENT=0
    -D MQTT_SUPPORT=0
    -D AT_MODE_SUPPORTED=1
    -D HTTP2SERIAL=0
    -D PING_MONITOR=0
    -D SSD1306_PLUGIN=1
    -D SSD1306_PLUGIN_128_32=1 -D SSD1306_PLUGIN_RESET_PIN=16 -D SSD1306_PLUGIN_SDA_PIN=4 -D SSD1306_PLUGIN_SCL_PIN=5
    ; -D ${debug_kfc.build_flags}

; -------------------------------------------------------------------------
; esp32 test
; -------------------------------------------------------------------------

[env:esp32]
platform = espressif32
board = heltec_wifi_lora_32

src_filter =
    ${debug_esp32.src_filter}
    +<../src/plugins/syslog/>
    +<../src/plugins/mqtt/>
    +<../src/plugins/http2serial/>
    +<../src/plugins/ssd1306_plugin/>

lib_ignore = ${env.lib_ignore}
    Adafruit TouchScreen
    Adafruit ADXL343
    Adafruit ILI9341
    Adafruit STMPE610
    Adafruit TouchScreen
    TinyWireM

lib_deps =
    Adafruit SSD1306
    https://github.com/sascha432/Adafruit-GFX-Library.git
    ${debug_esp32.lib_deps}

board_build.partitions = no_ota.csv

build_flags =
    ${debug_esp32.build_flags}
    ; -D CORE_DEBUG_LEVEL=0
    -D __LED_BUILTIN=25
    -D INVERT_BUILTIN_LED=0
    -D SYSLOG=1
    -D MQTT_SUPPORT=1
    -D AT_MODE_SUPPORTED=1
    -D TIMEZONE_USE_HTTP_CLIENT=1
    -D HTTP2SERIAL=1
    -D SERIAL2TCP=0
    -D REST_API_SUPPORT=0
    -D HOME_ASSISTANT_INTEGRATION=0
    -D PING_MONITOR=0
    -D I2CSCANNER_PLUGIN=0
    -D RTC_SUPPORT=0
    -D SSD1306_PLUGIN=1
    -D SSD1306_PLUGIN_128_64=1
    -D SSD1306_PLUGIN_RESET_PIN=16
    -D SSD1306_PLUGIN_SDA_PIN=4
    -D SSD1306_PLUGIN_SCL_PIN=15
    ${debug_kfc_all.build_flags}

[something]

# -D DEBUG_ESP_CORE -D DEBUG_ESP_WIFI

; -D ENABLE_GDB=1
; -D GDBSTUB_FREERTOS=0
; -D GDBSTUB_USE_OWN_STACK=0
; -D GDBSTUB_CTRLC_BREAK=0
; -D GDBSTUB_REDIRECT_CONSOLE_OUTPUT=1
; -D GDBSTUB_BREAK_ON_INIT=0
; -D DEBUG_ESP_CORE
; -D DEBUG_ESP_OOM
; -D DEBUG_ESP_WIFI
; -D DEBUG_ESP_SSL
; -D DEBUG_ESP_TLS_MEM
; -D DEBUG_ESP_HTTP_CLIENT
; -D DEBUG_ESP_HTTP_SERVER
; -D DEBUG_ESP_WIFI
; -D DEBUG_ESP_HTTP_UPDATE
; -D DEBUG_ESP_UPDATER
; -D DEBUG_ESP_OTA
; -D DEBUG_ESP_OOM -include "umm_malloc/umm_malloc_cfg.h"
; -D DEBUG_ESP_PORT=Serial

; ; NoAssert-NDEBUG
; build_flags = -DNDEBUG

; esptool.exe -vv -cd ck -cb 115200 -cp COM9 -ca 0x00000 -cf .pio\buid\debug\firmware.bin
